<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tea | Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
body{font-family:'Lato',sans-serif;margin:0;background:#fff;color:#333;}
header{background:#FF8A9D;padding:12px 24px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:999;}
header strong{font-family:'Playfair Display',serif;font-size:1.8rem;color:#fff;}
header nav a{color:#fff;margin:0 12px;text-decoration:none;font-weight:600;}
h2{text-align:center;color:#FF8A9D;font-family:'Playfair Display',serif;margin:30px 0;}
section{padding:20px 40px;}
button{background:#FF8A9D;color:white;border:none;padding:8px 18px;border-radius:30px;font-weight:bold;cursor:pointer;margin:5px 0;transition:all 0.3s;}
button:hover{background:#ff6f86;}
input,textarea{width:100%;padding:8px;margin:4px 0 10px;border-radius:8px;border:1px solid #ccc;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;}
.card{background:#fff;border-radius:16px;padding:15px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.08);position:relative;}
.card img{width:100%;border-radius:12px;margin-bottom:10px;}
.stock-badge{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:50%;background:#FF6F86;color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:bold;}
.badge{position:absolute;top:10px;left:10px;background:#FFCE00;color:#333;font-weight:bold;padding:4px 10px;border-radius:12px;font-size:0.8rem;margin-bottom:4px;display:inline-block;}
.product-id{font-size:0.75rem;color:#999;margin-bottom:5px;}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:.3s;z-index:9999;}
.modal-overlay.show{visibility:visible;opacity:1;}
.modal-box{background:#fff;padding:25px 35px;border-radius:14px;text-align:center;max-width:420px;}
.success{border-top:5px solid #4CAF50;}
.error{border-top:5px solid #f44336;}
.search-bar{width:90%;max-width:400px;margin:0 auto 20px;display:block;padding:10px 15px;border-radius:30px;border:1px solid #ccc;font-size:1rem;}
/* ORDER HISTORY */
table.orders{width:100%;border-collapse:collapse;margin-top:30px;}
table.orders th, table.orders td{border:1px solid #ddd;padding:8px;font-size:0.9rem;text-align:left;vertical-align:top;}
table.orders th{background:#FF8A9D;color:white;}
.order-items{margin:4px 0;padding-left:10px;font-size:0.85rem;background:#fff4f6;border-radius:8px;}
.order-items div{margin-bottom:2px;}
.status-badge{padding:4px 8px;border-radius:12px;color:#fff;font-weight:bold;font-size:0.75rem;}
.status-Pending{background:#FF6F86;}
.status-Completed{background:#28a745;}
.status-Cancelled{background:#f44336;}
</style>
</head>
<body>

<header>
  <strong>Tea Admin</strong>
</header>

<h2>Manage Products & Services</h2>
<input type="text" id="product-search" class="search-bar" placeholder="Search products by name, ID, or description">

<section>
  <h3>Add New Product/Service</h3>
  <input type="text" id="new-name" placeholder="Name">
  <input type="text" id="new-id" placeholder="ID">
  <textarea id="new-desc" placeholder="Description"></textarea>
  <input type="number" id="new-price" placeholder="Price (leave 0 for services)">
  <input type="number" id="new-stock" placeholder="Stock (leave 0 for services)">
  <input type="text" id="new-img" placeholder="Image URL">
  <input type="text" id="new-fresha" placeholder="Fresha Link (for services)">
  <label><input type="checkbox" id="new-trending"> Mark as Trending</label>
  <button onclick="addProduct()">Add Product/Service</button>
</section>

<section>
  <h3>Products & Services</h3>
  <div class="grid" id="products-grid"></div>
</section>

<h2>Manage Banners</h2>
<section>
  <h3>Add Banner Image</h3>
  <input type="text" id="banner-url" placeholder="Image URL">
  <button onclick="addBanner()">Add Banner</button>
  <div class="grid" id="banners-grid" style="margin-top:20px;"></div>
</section>

<section>
  <h3>Custom Badge</h3>
  <input type="text" id="custom-badge-text" placeholder="Badge label">
  <input type="text" id="custom-badge-id" placeholder="Product/Service ID">
  <button onclick="addCustomBadge()">Add Badge</button>
</section>

<!-- Order History -->
<h2>Order History</h2>
<section>
  <table class="orders" id="orders-table">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer Info</th> <!-- NEW COLUMN -->
        <th>Items</th>
        <th>Subtotal</th>
        <th>Tax</th>
        <th>Delivery</th>
        <th>Total</th>
        <th>Address</th>
        <th>Payment</th>
        <th>Status</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal-box" id="modal-box">
    <p id="modal-text"></p><br>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
// ===== STORAGE =====
let products = JSON.parse(localStorage.getItem('products')) || [];
let banners = JSON.parse(localStorage.getItem('banners')) || [];
let customBadges = JSON.parse(localStorage.getItem('customBadges')) || [];

// ===== MODAL =====
function showModal(msg,error=false){
  const modal=document.getElementById('modal');
  const box=document.getElementById('modal-box');
  document.getElementById('modal-text').innerText=msg;
  box.className='modal-box '+(error?'error':'success');
  modal.classList.add('show');
}
function closeModal(){ document.getElementById('modal').classList.remove('show'); }

// ===== PRODUCTS RENDER =====
const productsGrid = document.getElementById('products-grid');
function renderProducts(filter=''){
  productsGrid.innerHTML='';
  const now = new Date();
  products.filter(p=>{ const text=(p.name+p.desc+p.id).toLowerCase(); return text.includes(filter.toLowerCase()); })
  .forEach((p,index)=>{
    const card=document.createElement('div');
    card.className='card'+(p.type==='service'?' product-type-service':'');
    let badgesHTML='';
    if(p.type==='service'){ badgesHTML+='<div class="badge">Service</div>'; }
    if(p.createdAt){ const diffDays=(now-new Date(p.createdAt))/(1000*60*60*24); if(diffDays<=7) badgesHTML+='<div class="badge">New Drop</div>'; }
    if(p.trending){ badgesHTML+='<div class="badge">Trending</div>'; }
    customBadges.forEach(b=>{ if(b.id===p.id){ badgesHTML+=`<div class="badge">${b.label}</div>`; } });
    card.innerHTML=`
      ${badgesHTML}
      <img src="${p.img}" alt="${p.name}">
      <p class="product-id">ID: ${p.id}</p>
      <input type="text" value="${p.name}" onchange="updateProduct(${index},'name',this.value)">
      <input type="text" value="${p.id}" onchange="updateProduct(${index},'id',this.value)">
      <textarea onchange="updateProduct(${index},'desc',this.value)">${p.desc}</textarea>
      <input type="number" value="${p.price}" onchange="updateProduct(${index},'price',this.value)">
      <input type="number" value="${p.stock}" onchange="updateProduct(${index},'stock',this.value)">
      <input type="text" value="${p.img}" onchange="updateProduct(${index},'img',this.value)">
      <input type="text" value="${p.freshaLink||''}" placeholder="Fresha Link" onchange="updateProduct(${index},'freshaLink',this.value)">
      <label><input type="checkbox" ${p.trending?'checked':''} onchange="updateProduct(${index},'trending',this.checked)"> Trending</label>
      <button onclick="deleteProduct(${index})">Delete</button>
    `;
    productsGrid.appendChild(card);
  });
}
renderProducts();
document.getElementById('product-search').addEventListener('input',(e)=>{ renderProducts(e.target.value); });

// ===== ADD/UPDATE/DELETE PRODUCTS =====
function addProduct(){
  const name=document.getElementById('new-name').value.trim();
  const id=document.getElementById('new-id').value.trim();
  const desc=document.getElementById('new-desc').value.trim();
  const price=+document.getElementById('new-price').value;
  const stock=+document.getElementById('new-stock').value;
  const img=document.getElementById('new-img').value.trim();
  const freshaLink=document.getElementById('new-fresha').value.trim();
  const trending=document.getElementById('new-trending').checked;
  if(!name||!id||!desc||!img){ showModal('Fill required fields',true); return; }
  const type=(price>0 && stock>0)?'product':'service';
  products.push({name,id,desc,price,stock,img,type,freshaLink,createdAt:new Date(),trending});
  localStorage.setItem('products',JSON.stringify(products));
  renderProducts(); showModal('Product/Service added');
  document.getElementById('new-name').value=''; document.getElementById('new-id').value='';
  document.getElementById('new-desc').value=''; document.getElementById('new-price').value='';
  document.getElementById('new-stock').value=''; document.getElementById('new-img').value='';
  document.getElementById('new-fresha').value=''; document.getElementById('new-trending').checked=false;
}
function updateProduct(index,key,value){
  if(key==='price'||key==='stock') value=Number(value);
  products[index][key]=value;
  localStorage.setItem('products',JSON.stringify(products));
  showModal(`Updated ${key}`);
}
function deleteProduct(index){
  if(confirm('Delete this item?')){
    products.splice(index,1);
    localStorage.setItem('products',JSON.stringify(products));
    renderProducts();
    showModal('Deleted successfully');
  }
}

// ===== BANNERS =====
const bannersGrid=document.getElementById('banners-grid');
function renderBanners(){ 
  bannersGrid.innerHTML='';
  banners.forEach((src,i)=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`<img src="${src}" style="height:150px;object-fit:cover;"><button onclick="deleteBanner(${i})">Delete</button>`;
    bannersGrid.appendChild(card);
  });
}
renderBanners();
function addBanner(){
  const url=document.getElementById('banner-url').value.trim();
  if(!url){ showModal('Enter valid URL',true); return; }
  banners.push(url);
  localStorage.setItem('banners',JSON.stringify(banners));
  renderBanners();
  showModal('Banner added');
  document.getElementById('banner-url').value='';
}
function deleteBanner(index){
  if(confirm('Delete this banner?')){
    banners.splice(index,1);
    localStorage.setItem('banners',JSON.stringify(banners));
    renderBanners();
    showModal('Banner deleted');
  }
}

// ===== CUSTOM BADGE =====
function addCustomBadge(){
  const label=document.getElementById('custom-badge-text').value.trim();
  const id=document.getElementById('custom-badge-id').value.trim();
  if(!label||!id){ showModal('Enter label and ID',true); return; }
  customBadges.push({id,label});
  localStorage.setItem('customBadges',JSON.stringify(customBadges));
  renderProducts();
  showModal('Custom badge added');
  document.getElementById('custom-badge-text').value='';
  document.getElementById('custom-badge-id').value='';
}

// ===== ORDER HISTORY =====
function renderOrders(){
  const tbody=document.querySelector('#orders-table tbody');
  tbody.innerHTML='';
  const orders=JSON.parse(localStorage.getItem('orderHistory'))||[];
  orders.reverse().forEach(order=>{
    let itemsHTML='<div class="order-items">';
    order.cart.forEach(item=>{
      const qty=item.qty||1;
      itemsHTML+=`<div>${item.name} x ${qty} = GYD ${(item.price*qty).toLocaleString()}</div>`;
    });
    itemsHTML+='</div>';

    const statusClass='status-'+order.status;
    const row=document.createElement('tr');
    row.innerHTML=`
      <td>${order.id}</td>
      <td>${order.firstName} ${order.lastName}<br>${order.phone}</td> <!-- NEW COLUMN -->
      <td>${itemsHTML}</td>
      <td>GYD ${order.subtotal.toLocaleString()}</td>
      <td>GYD ${order.tax.toLocaleString()}</td>
      <td>GYD ${order.deliveryFee.toLocaleString()}</td>
      <td>GYD ${order.total.toLocaleString()}</td>
      <td>${order.address}</td>
      <td>${order.payment}</td>
      <td><span class="status-badge ${statusClass}">${order.status}</span></td>
      <td>${order.timestamp}</td>
    `;
    tbody.appendChild(row);
  });
}
renderOrders();
</script>

</body>
</html>
